FROM apache/kafka:3.9.1

USER root
COPY init.sh /init.sh
COPY log4j.properties /opt/kafka/config/log4j.properties
RUN chmod +x /init.sh

# ENV KAFKA_NODE_ID=1 \
# 	KAFKA_PROCESS_ROLES=broker,controller \
# 	KAFKA_AUTO_CREATE_TOPICS_ENABLE=true \
# 	KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 \
# 	KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092 \
# 	KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
# 	KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT \
# 	KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:9093 \
# 	KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 \
# 	KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1 \
# 	KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1 \
# 	KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0 \
# 	KAFKA_NUM_PARTITIONS=1 \
# 	KAFKA_LOG_DIRS=/var/lib/kafka/data \
# 	KAFKAJS_NO_PARTITIONER_WARNING=1



ENV \
  KAFKA_NODE_ID=1 \
  KAFKA_PROCESS_ROLES=broker,controller \
  KAFKA_AUTO_CREATE_TOPICS_ENABLE=true \
  KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 \
  KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092 \
  KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER \
  KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT \
  KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:9093 \
  KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1 \
  KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1 \
  KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1 \
  KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0 \
  KAFKA_NUM_PARTITIONS=4 \
  KAFKA_LOG_DIRS=/var/lib/kafka/data \
  KAFKA_LOG_RETENTION_HOURS=12 \
  KAFKA_LOG_SEGMENT_BYTES=134217728 \
  KAFKA_LOG_RETENTION_CHECK_INTERVAL_MS=300000 \
  KAFKA_MESSAGE_MAX_BYTES=10485760 \
  KAFKA_REPLICA_FETCH_MAX_BYTES=10485760 \
  KAFKA_FETCH_MESSAGE_MAX_BYTES=10485760 \
  KAFKA_SOCKET_REQUEST_MAX_BYTES=10485760 \
  KAFKA_JVM_PERFORMANCE_OPTS="-Xmx512M -Xms256M" \
  KAFKAJS_NO_PARTITIONER_WARNING=1



ENTRYPOINT ["/init.sh"]